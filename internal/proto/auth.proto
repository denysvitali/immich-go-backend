syntax = "proto3";

package immich.v1;

import "common.proto";
import "google/api/annotations.proto";
import "google/protobuf/empty.proto";

option go_package = "github.com/denysvitali/immich-go-backend/gen/immich/v1;immichv1";

// Authentication service
service AuthService {
  // Login with email and password
  rpc Login(LoginRequest) returns (LoginResponse) {
    option (google.api.http) = {
      post: "/api/auth/login"
      body: "*"
    };
  }

  // Admin sign up
  rpc AdminSignUp(AdminSignUpRequest) returns (LoginResponse) {
    option (google.api.http) = {
      post: "/api/auth/admin-sign-up"
      body: "*"
    };
  }

  // Change password
  rpc ChangePassword(ChangePasswordRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      post: "/api/auth/change-password"
      body: "*"
    };
  }

  // Logout
  rpc Logout(google.protobuf.Empty) returns (LogoutResponse) {
    option (google.api.http) = {
      post: "/api/auth/logout"
      body: "*"
    };
  }

  // Validate token
  rpc ValidateToken(google.protobuf.Empty) returns (ValidateTokenResponse) {
    option (google.api.http) = {
      post: "/api/auth/validateToken"
      body: "*"
    };
  }

  // Get auth status - returns session info and whether user has password
  rpc GetAuthStatus(google.protobuf.Empty) returns (AuthStatusResponse) {
    option (google.api.http) = {
      get: "/api/auth/status"
    };
  }

  // Setup PIN code for the current user
  rpc SetupPinCode(PinCodeSetupRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      post: "/api/auth/pin-code"
      body: "*"
    };
  }

  // Change PIN code for the current user
  rpc ChangePinCode(PinCodeChangeRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      put: "/api/auth/pin-code"
      body: "*"
    };
  }

  // Reset PIN code by providing account password
  rpc ResetPinCode(PinCodeResetRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/api/auth/pin-code"
    };
  }

  // Unlock session with PIN code to access locked assets
  rpc UnlockSession(SessionUnlockRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      post: "/api/auth/session/unlock"
      body: "*"
    };
  }

  // Lock session to revoke access to locked assets
  rpc LockSession(google.protobuf.Empty) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      post: "/api/auth/session/lock"
      body: "*"
    };
  }
}

// Login request
message LoginRequest {
  string email = 1;
  string password = 2;
}

// Login response
message LoginResponse {
  string access_token = 1;
  string user_id = 2;
  string user_email = 3;
  string name = 4;
  string profile_image_path = 5;
  bool is_admin = 6;
  bool should_change_password = 7;
}

// Admin sign up request
message AdminSignUpRequest {
  string email = 1;
  string password = 2;
  string name = 3;
}

// Change password request
message ChangePasswordRequest {
  string current_password = 1;
  string new_password = 2;
}

// Logout response
message LogoutResponse {
  bool successful = 1;
  string redirect_uri = 2;
}

// Validate token response
message ValidateTokenResponse {
  bool auth_status = 1;
}

// Auth status response
message AuthStatusResponse {
  bool has_password = 1;
  bool is_elevated = 2;  // Whether session has elevated access to locked assets
  bool pin_code_enabled = 3;
}

// PIN code setup request
message PinCodeSetupRequest {
  string pin_code = 1;
}

// PIN code change request
message PinCodeChangeRequest {
  string current_pin_code = 1;
  string new_pin_code = 2;
}

// PIN code reset request (requires account password)
message PinCodeResetRequest {
  string password = 1;
}

// Session unlock request
message SessionUnlockRequest {
  string pin_code = 1;
}
